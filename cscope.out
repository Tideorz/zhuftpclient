cscope 15 $HOME/zhuftpclient -q 0000000449 0000035795
	@In file included from ftpclient_UI.h

	@defines.h

10 
	~<¨∑/öë.h
>

11 
	~<as£π.h
>

12 
	~<î∫o.h
>

13 
	~<dúít.h
>

14 
	~<glib.h
>

15 
	~<gΩ.h
>

16 
	~<gtk/gtk.h
>

17 
	~<mÆloc.h
>

18 
	~<√tdb.h
>

19 
	~<√töë/ö.h
>

20 
	~<pwd.h
>

21 
	~<±hªad.h
>

22 
	~<sig«l.h
>

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<°rög.h
>

26 
	~<sys/io˘l.h
>

27 
	~<sys/£À˘.h
>

28 
	~<sys/sockë.h
>

29 
	~<sys/°©.h
>

30 
	~<sys/time.h
>

31 
	~<sys/ty≥s.h
>

32 
	~<time.h
>

33 
	~<uni°d.h
>

36 #i‚de‡
__DEFINES_H


37 
	#__DEFINES_H


	)

39 #ifde‡
__˝lu•lus


43 
	#MAXPATHLEN
 256

	)

44 
	#MAXUSERLEN
 50

	)

45 
	#SENDBUFSIZE
 512

	)

46 
	#READBUFSIZE
 512

	)

47 
	#DELIM
 " "

	)

50 
	#TIME_OUT_SEC
 50

	)

51 
cuºít_dú
[
MAXPATHLEN
];

56 
COLUMN_FILENAME
,

57 
COLUMN_FILESIZE
,

58 
COLUMN_OWNNAME
,

59 
COLUMN_GROUPNAME
,

60 
COLUMN_DATE
,

61 
COLUMN_FILESTATE
,

62 
NUM_COLUMNS


67 *
fûe_«me
;

68 
guöt
 
fûe_size
;

69 
gch¨
 *
own_«me
;

70 
gch¨
 *
group_«me
;

71 
gch¨
 *
d©e
;

72 
gch¨
 *
fûe_°©e
;

73 }
	tFûe
;

75 
fûe_buf
 
	tfûe_buf
;

76 
	sfûe_buf


78 
fûe_d©a
[300];

79 
fûe_buf
 *
√xt
;

82 
sum_fûes
;

87 
fûe_buf
 *
fûebuf_hód
;

88 
fûe_buf
 *
fûebuf_èû
;

89 
göt
 
ªmŸe_fûíum
;

94 *
	gù
;

95 *
	gd©a_sock
;

96 }
	tp‹t_d©a
;

99 
	gp‹t_li°í_sock
;

103 #ifde‡
__˝lu•lus


	@fileutils.c

9 
	~"fûeutûs.h
"

11 
	gsum_fûes
;

12 
gboﬁón
 
	gfú°_›í
 = 
TRUE
;

15 
göt
 
	$tŸÆ_fûíum
(
dúít
 *
d_√xt
, 
DIR
 *
dú
)

17 
göt
 
sum
 = 0;

18 
d_√xt
 !
NULL
)

20 
sum
++;

21 
d_√xt
 = 
	`ªaddú
(
dú
);

23  
sum
;

24 
	}
}

27 
	$‰ì_fûe
(
Fûe
 **
fûe
)

29 
i
 = 0;

30 
Fûe
 *
±r
 = *
fûe
;

31 
i
; i<
sum_fûes
; i++)

33 
	`‰ì
((*)(
±r
->
fûe_«me
));

34 
	`‰ì
((*)(
±r
->
own_«me
));

35 
	`‰ì
((*)(
±r
->
group_«me
));

36 
	`‰ì
((*)(
±r
->
d©e
));

37 
	`‰ì
((*)(
±r
->
fûe_°©e
));

38 
±r
++;

40 
	`‰ì
(*
fûe
);

41 *
fûe
 = 
NULL
;

42 
	}
}

45 
gboﬁón
 
	$mÆloc_fûe
–
Fûe
 *
fûe
, 
sumfûes
)

47 
i
 = 0;

48 
i
 ; i<
sumfûes
; ++i)

50 
fûe
->
fûe_«me
 = (
gch¨
*)
	`mÆloc
(
MAXPATHLEN
 *(gchar));

51 if(
fûe
->
fûe_«me
 =
NULL
)

53  
FALSE
;

55 
fûe
->
own_«me
 = ( 
gch¨
*)
	`mÆloc
(
MAXUSERLEN
 *(gchar));

56 if(
fûe
->
own_«me
 =
NULL
)

58  
FALSE
;

60 
fûe
->
group_«me
 = (
gch¨
*)
	`mÆloc
(
MAXUSERLEN
 *(gchar));

61 if(
fûe
->
group_«me
 =
NULL
)

63  
FALSE
;

65 
fûe
->
d©e
 = (
gch¨
*)
	`mÆloc
(20*( gchar));

66 if(
fûe
->
d©e
 =
NULL
)

68  
FALSE
;

71 
fûe
->
fûe_°©e
 = (
gch¨
*)
	`mÆloc
(11*(gchar));

72 if(
fûe
->
fûe_°©e
 =
NULL
)

74  
FALSE
;

76 
fûe
++;

78  
TRUE
;

79 
	}
}

83 
gboﬁón
 
	$gë_fûe_öfo
(*
fûe_«me
, 
Fûe
 *
loˇl_fûe
)

85 
°©
 
s_buff
;

86 
°©us
 = 
	`°©
(
fûe_«me
,&
s_buff
);

87 if(
°©us
 != 0)

89 
	`¥ötf
("°©Éº‹:%s\n",
fûe_«me
);

90 
	`≥º‹
("stat:\n");

91  
TRUE
;

93  
	`gë_fûe_öfo_°©
(
fûe_«me
,&
s_buff
,
loˇl_fûe
);

94 
	}
}

97 
gboﬁón
 
	$gë_fûe_öfo_°©
(c⁄° *
fûe_«me
,
°©
 *
s_buff
, 
Fûe
 *
loˇl_fûe
)

99 
d©e
[20];

100 
mode
[11] ="----------";

101 if(
s_buff
 =
NULL
 || 
loˇl_fûe
 == NULL)

103 
	`¥ötf
("s_buf‡‹Üoˇl_fûêi†NULLÖoöãr:%s\n",
fûe_«me
);

104  
FALSE
;

107 
mode_t
 
fûe_mode
 = 
s_buff
->
°_mode
;

108 
∑sswd
 *
∑sswd_öfo
 = 
	`gëpwuid
(
s_buff
->
°_uid
);

109 if(
∑sswd_öfo
 =
NULL
)

111 
	`mem£t
(&
î∫o
,0,(errno));

112 
	`¥ötf
("î∫o:%s",
	`°ªº‹
(
î∫o
));

113 
	`¥ötf
("%s\n",
fûe_«me
);

114  
TRUE
;

116 if(
∑sswd_öfo
 !
NULL
)

118 
group
 *
group_öfo
 = 
	`gëgrgid
(
s_buff
->
°_gid
);

119 if(
group_öfo
 =
NULL
)

121 
	`¥ötf
("gëgrgidÉº‹:%s\n",
fûe_«me
);

123 if(
group_öfo
 !
NULL
)

126 if(
	`S_ISDIR
(
fûe_mode
))

127 
mode
[0] = 'd';

128 if(
	`S_ISREG
(
fûe_mode
))

129 
mode
[0] = 'r';

130 if(
	`S_ISCHR
(
fûe_mode
))

131 
mode
[0] = 'c';

132 if(
	`S_ISBLK
(
fûe_mode
))

133 
mode
[0] = 'b';

134 if(
	`S_ISFIFO
(
fûe_mode
))

135 
mode
[0] = 'p';

136 if(
	`S_ISLNK
(
fûe_mode
))

137 
mode
[0] = 'l';

138 if(
	`S_ISSOCK
(
fûe_mode
))

139 
mode
[0] = 's';

142 
	`¥ötf
("fûêmodêîr‹:%s\n",
fûe_«me
);

143  
FALSE
;

148 
mode
[1] = (
fûe_mode
 & 
S_IRUSR
) ? 'r' : '-';

149 
mode
[2] = (
fûe_mode
 & 
S_IWUSR
) ? 'w' : '-';

150 
mode
[3] = (
fûe_mode
 & 
S_IXUSR
) ? 'x' : '-';

151 
mode
[4] = (
fûe_mode
 & 
S_IRGRP
) ? 'r' : '-';

152 
mode
[5] = (
fûe_mode
 & 
S_IWGRP
) ? 'w' : '-';

153 
mode
[6] = (
fûe_mode
 & 
S_IXGRP
) ? 'x' : '-';

154 
mode
[7] = (
fûe_mode
 & 
S_IROTH
) ? 'r' : '-';

155 
mode
[8] = (
fûe_mode
 & 
S_IWOTH
) ? 'w' : '-';

156 
mode
[9] = (
fûe_mode
 & 
S_IXOTH
) ? 'x' : '-';

158 
	`°r·ime
(
d©e
,13,"%b %d %H:%M",
	`loˇ…ime
(&(
s_buff
->
°_mtime
)));

161 
	`°r˝y
(
loˇl_fûe
->
fûe_«me
,file_name);

162 
loˇl_fûe
->
fûe_size
 = (
göt
)
s_buff
->
°_size
;

163 
	`°r˝y
(
loˇl_fûe
->
own_«me
,
∑sswd_öfo
->
pw_«me
);

164 
	`°r˝y
(
loˇl_fûe
->
group_«me
,
group_öfo
->
gr_«me
);

165 
	`°r˝y
(
loˇl_fûe
->
d©e
,date);

166 
	`°r˝y
(
loˇl_fûe
->
fûe_°©e
,
mode
);

167  
TRUE
;

172  
FALSE
;

173 
	}
}

176 
gboﬁón
 
	$wrôe_loˇŒi°
(c⁄° *
cuºít_dú
, 
Fûe
 **
loˇl_fûe
)

179 
gboﬁón
 
Êag
;

180 
√w_fûíame
[
MAXPATHLEN
];

183 if(
	`chdú
(
cuºít_dú
) == -1)

185  
FALSE
;

188 
DIR
 *
dú
 = 
	`›ídú
(
cuºít_dú
);

189 if(
dú
 =
NULL
)

191  
FALSE
;

194 
dúít
 *
fú°_fûe
 = 
	`ªaddú
(
dú
);

197 if(*
loˇl_fûe
 !
NULL
)

199 
	`‰ì_fûe
(
loˇl_fûe
);

202 
sum_fûes
 = 
	`tŸÆ_fûíum
(
fú°_fûe
,
dú
) -1;

203 if(
sum_fûes
 == 0)

205  
FALSE
;

208 *
loˇl_fûe
 = 
	`mÆloc
((
sum_fûes
)*(
Fûe
));

209 
Fûe
 * 
±r
 = *
loˇl_fûe
;

211 if(*
loˇl_fûe
 =
NULL
)

213  
FALSE
;

216 
Êag
 = 
	`mÆloc_fûe
(*
loˇl_fûe
,
sum_fûes
);

217 if(!
Êag
)

219  
FALSE
;

223 
	`ªwöddú
(
dú
);

230 
dúít
 *
d_√xt
 = 
	`ªaddú
(
dú
);

231 if(
d_√xt
 =
NULL
)

235 if(
	`°rcmp
(
d_√xt
->
d_«me
,".") == 0)

239 if(!
	`gë_fûe_öfo
(
d_√xt
->
d_«me
,
±r
))

241  
FALSE
;

243 
±r
++;

245  
TRUE
;

246 
	}
}

249 
gboﬁón
 
	$wrôe_ªmŸñi°
(
fûe_buf
 *
fûebuf_hód
, 
Fûe
 ** 
ªmŸe_fûe
)

251 
gboﬁón
 
Êag
;

252 if(*
ªmŸe_fûe
 !
NULL
)

254 
	`‰ì_fûe
(
ªmŸe_fûe
);

258 
ªmŸe_fûe
 = 
	`mÆloc
(
ªmŸe_fûíum
*(
Fûe
));

259 
Fûe
 *
f_±r
 = *
ªmŸe_fûe
;

261 
Êag
 = 
	`mÆloc_fûe
(*
ªmŸe_fûe
,
ªmŸe_fûíum
);

262 if(!
Êag
)

264  
FALSE
;

267 
fûe_buf
 *
fb_±r
 = 
fûebuf_hód
->
√xt
;

268 
fb_±r
 !
NULL
)

270 
	`∑r£_fûe_buf
(
fb_±r
,
f_±r
);

271 
f_±r
++;

272 
fb_±r
 = fb_±r->
√xt
;

274  
TRUE
;

275 
	}
}

279 
	$∑r£_fûe_buf
(
fûe_buf
 *
fb_±r
, 
Fûe
 *
f_±r
)

281 *
ªsu…
;

282 
löe
[300];

283 
	`°rcmp
(
löe
,
fb_±r
->
fûe_d©a
);

286 
ªsu…
 = 
	`°πok
(
löe
, 
DELIM
);

287 
	`°rcmp
(
f_±r
->
fûe_°©e
,
ªsu…
);

290 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

293 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

294 
	`°rcmp
(
f_±r
->
own_«me
,
ªsu…
);

297 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

298 
	`°rcmp
(
f_±r
->
group_«me
,
ªsu…
);

301 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

302 
f_±r
->
fûe_size
 = 
	`©oi
(
ªsu…
);

305 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

306 
	`°rcmp
(
f_±r
->
d©e
,
ªsu…
);

309 
ªsu…
 = 
	`°πok
(
NULL
,
DELIM
);

310 
	`°rcmp
(
f_±r
->
fûe_«me
,
ªsu…
);

311 
	}
}

	@fileutils.h

9 
	~"deföes.h
"

10 #i‚de‡
__FILEUTILS_H


11 
	#__FILEUTILS_H


	)

13 #ifde‡
__˝lu•lus


18 
göt
 
tŸÆ_fûíum
(
dúít
 *
d_√xt
, 
DIR
 *
dú
);

19 
‰ì_fûe
–
Fûe
 **
fûe
);

20 
gboﬁón
 
mÆloc_fûe
–
Fûe
 *
fûe
, 
sum_fûes
);

21 
gboﬁón
 
gë_fûe_öfo
(*
fûe_«me
, 
Fûe
 *
loˇl_fûe
);

22 
gboﬁón
 
gë_fûe_öfo_°©
(c⁄° *
fûe_«me
,
°©
 *
s_buff
, 
Fûe
 *
loˇl_fûe
);

23 
gboﬁón
 
wrôe_loˇŒi°
(c⁄° *
cuºít_dú
, 
Fûe
 **
loˇl_fûe
);

28 #ifde‡
__˝lu•lus


	@ftpclient_UI.c

10 
	~"·p˛õ¡_UI.h
"

12 
GtkWidgë
 *
	gsw_loˇŒi°
;

13 
GtkWidgë
 *
	gåìvõw_loˇl
;

14 
GtkWidgë
 *
	gíåy_loˇlwd
;

16 
GtkWidgë
 *
	gsw_ªmŸñi°
;

17 
GtkWidgë
 *
	gåìvõw_ªmŸe
;

19 
GtkWidgë
 *
	gíåy_IP
;

20 
GtkWidgë
 *
	gíåy_PORT
;

21 
GtkWidgë
 *
	gíåy_u£∫ame
;

22 
GtkWidgë
 *
	gíåy_PASSWD
;

25 
GtkE¡ryBuf„r
 *
	gíåy_buf„r_£rvîwd
;

29 
GtkWidgë
 *
	gãxt_võw_öãºa˘
;

30 
GtkTextM¨k
 *
	gãxt_m¨k_log
;

33 
gboﬁón
 
	gis_ab‹t_down
 = 
FALSE
;

35 
±hªad_muãx_t
 
	ggtk_muãx
;

38 
	gsum_fûes
;

39 
	gcomm™d
[
SENDBUFSIZE
];

42 
	gcomm™d_sock
;

44 
	gd©a_sock
 = -1;

46 
göt
 
	gd©a_c⁄√˘i⁄_mëhod
 = 1;

50 
göt
 
	$dñëe_evít_t›_wödow
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

52  
FALSE
;

53 
	}
}

56 
	$de°roy
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

58 
	`gtk_maö_quô
();

59 
	}
}

62 
	$de°roy_widgë
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

64 
GtkWidgë
 *
de_widgë
 = (GtkWidgë*Ë
d©a
;

65 
	`gtk_widgë_de°roy
(
de_widgë
);

66 
	}
}

69 
GtkTªeModñ
 *
	$¸óã_li°_modñ
(
Fûe
 *
fûe_d©a
,
göt
 
sum_fûes
)

71 
göt
 
i
;

72 
GtkTªeIãr
 
ôî
;

73 
GtkLi°St‹e
 *
°‹e
;

74 
°‹e
 = 
	`gtk_li°_°‹e_√w
(
NUM_COLUMNS
,

75 
G_TYPE_STRING
,

76 
G_TYPE_UINT
,

77 
G_TYPE_STRING
,

78 
G_TYPE_STRING
,

79 
G_TYPE_STRING
,

80 
G_TYPE_STRING


82 
i
=0; i<
sum_fûes
; i++)

84 
	`gtk_li°_°‹e_≠≥nd
(
°‹e
,&
ôî
);

85 
	`gtk_li°_°‹e_£t
(
°‹e
,&
ôî
,

86 
COLUMN_FILENAME
, ((
fûe_d©a
->
fûe_«me
)),

87 
COLUMN_FILESIZE
, (
fûe_d©a
->
fûe_size
),

88 
COLUMN_OWNNAME
, ((
fûe_d©a
->
own_«me
)),

89 
COLUMN_GROUPNAME
, ((
fûe_d©a
->
group_«me
)),

90 
COLUMN_DATE
, ((
fûe_d©a
->
d©e
)),

91 
COLUMN_FILESTATE
, ((
fûe_d©a
->
fûe_°©e
)),

93 
fûe_d©a
++;

95  
	`GTK_TREE_MODEL
(
°‹e
);

97 
	}
}

99 
	$add_cﬁumns
 (
GtkTªeVõw
 *
åìvõw
)

101 
GtkCñlRídîî
 *
ªndîî
;

102 
GtkTªeVõwCﬁumn
 *
cﬁumn
;

105 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_ãxt_√w
 ();

106 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 ("File Name",

107 
ªndîî
,

109 
COLUMN_FILENAME
,

110 
NULL
);

111 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_FILENAME
);

112 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

115 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_ãxt_√w
 ();

116 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (("File Size"),

117 
ªndîî
,

119 
COLUMN_FILESIZE
,

120 
NULL
);

121 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_FILESIZE
);

122 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

125 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_ãxt_√w
 ();

126 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (("Own Name"),

127 
ªndîî
,

129 
COLUMN_OWNNAME
,

130 
NULL
);

131 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_OWNNAME
);

132 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

135 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (("Group Name"),

136 
ªndîî
,

138 
COLUMN_GROUPNAME
,

139 
NULL
);

141 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_GROUPNAME
);

142 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

145 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (("Date"),

146 
ªndîî
,

148 
COLUMN_DATE
,

149 
NULL
);

151 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_DATE
);

152 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

155 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (("Attribute"),

156 
ªndîî
,

158 
COLUMN_FILESTATE
,

159 
NULL
);

161 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁumn
, 
COLUMN_FILESTATE
);

162 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
åìvõw
, 
cﬁumn
);

164 
	}
}

167 
gboﬁón
 
	$ª•⁄£_íåy_íãr
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

169 c⁄° 
gch¨
* 
∑th
;

170 
cw
[
MAXPATHLEN
];

171 
∑th
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
widgë
));

172 
Fûe
 * 
fûe
 = 
loˇl_fûe
;

173 
GtkTªeModñ
 *
√w
;

175 if(
	`wrôe_loˇŒi°
(
∑th
,&
loˇl_fûe
Ë=
FALSE
)

177 
	`show_ãxt_√ws
("Path Error!!!");

178  
FALSE
;

180 
	`gëcwd
(
cw
,
MAXPATHLEN
);

181 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
),
cw
);

183 
√w
 = 
	`¸óã_li°_modñ
(
loˇl_fûe
,
sum_fûes
);

184 
	`gtk_åì_võw_£t_modñ
((
GtkTªeVõw
*)
åìvõw_loˇl
,
√w
);

185 
	`g_obje˘_uƒef
(
√w
);

186  
TRUE
;

187 
	}
}

190 
gboﬁón
 
	$£t_ªmŸe_fûñi°_åìvõw_modñ
()

192 
GtkTªeModñ
 *
√w
;

193 if(
	`wrôe_ªmŸñi°
(
fûebuf_hód
,&
ªmŸe_fûe
Ë=
FALSE
)

195 
	`show_ãxt_√ws
("Remote filelist create Error");

196  
FALSE
;

199 
√w
 = 
	`¸óã_li°_modñ
(
ªmŸe_fûe
,
ªmŸe_fûíum
);

200 
	`gtk_åì_võw_£t_modñ
((
GtkTªeVõw
*)
åìvõw_ªmŸe
,
√w
);

201 
	`g_obje˘_uƒef
(
√w
);

202  
TRUE
;

203 
	}
}

207 
	$dól_wôh_îr‹
(
göt
 
Êag
)

209 
Êag
)

212 
	`show_ãxt_√ws
("TryÅoÑeconnectÅhe server");

215 
	`show_ãxt_√ws
("Havn't gotÅhe serverÑeply");

218 
	`show_ãxt_√ws
("Command contentÉrror");

223 
	}
}

226 
gboﬁón
 
	$£nd_™d_ª•⁄£
(
sock
,*
comm™d
, c⁄° *
ok_°r
, *
ª∂y
, 
Àn
)

228 
	`show_ãxt_√ws
("\n");

229 
	`show_ãxt_√ws
(
comm™d
);

230 
comm™d
[
Àn
] = '\0';

231 if(
sock
 == -1)

233 
	`show_ãxt_√ws
("Command connection has been close");

234  
FALSE
;

236 
Êag
 = 
	`c⁄åﬁ_c⁄√˘i⁄_›î©i⁄
(
sock
, 
comm™d
, 
ª∂y
, 
ok_°r
);

237 
	`show_ãxt_√ws
(
ª∂y
);

238 if(
Êag
 != 0)

240 
	`dól_wôh_îr‹
(
Êag
);

241 
	`˛o£
(
sock
);

242  
FALSE
;

244  
TRUE
;

245 
	}
}

248 
	$gë_w‹k_dúe˘‹y
(* 
ª∂y
)

250 *
p
 = 
	`°πok
(
ª∂y
,"\"");

251 
p
 = 
	`°πok
(
NULL
,"\"");

252 
	`gtk_íåy_buf„r_£t_ãxt
(
íåy_buf„r_£rvîwd
,
p
,
	`°æí
(p));

253 
	}
}

256 
gboﬁón
 
	$ª•⁄£_buâ⁄_logö_down
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

258 
göt
 
Êag
;

259 
gboﬁón
 
ªsu…
;

260 
ª∂y
[100];

262 c⁄° 
gch¨
 *
ù
;

263 c⁄° 
gch¨
 *
p‹t
;

264 c⁄° 
gch¨
 *
u£r_«me
;

265 c⁄° 
gch¨
 *
∑sswd
;

267 
ù
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
íåy_IP
));

268 
p‹t
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
íåy_PORT
));

269 
u£r_«me
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
íåy_u£∫ame
));

270 
∑sswd
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
íåy_PASSWD
));

272 if(
	`°rcmp
(
ù
,""Ë=0 || såcmp(
p‹t
,""Ë=0 || såcmp(
u£r_«me
,"") == 0)

274 
	`show_ãxt_√ws
("Login Info Not Complete!!!");

275  
FALSE
;

279 
comm™d_sock
 = 
	`make_£rvî_c⁄√˘i⁄
(
ù
,
p‹t
,0);

280 if(
comm™d_sock
 == -1)

282 
	`show_ãxt_√ws
("Can't create command connection,\n Server or Network isÇot doing!!!");

283  
FALSE
;

285 
	`show_ãxt_√ws
("Connection Finished");

287 
ªsu…
 = 
	`gë_ª∂y_‰om_£rvî
(
comm™d_sock
, 
ª∂y
);

288 if(!
ªsu…
)

290 
	`dól_wôh_îr‹
(-2);

291 
	`˛o£
(
comm™d_sock
);

292  
FALSE
;

294 
	`show_ãxt_√ws
(
ª∂y
);

296 
ªsu…
 = 
	`comm™d_is_ok
("220", 
ª∂y
);

297 if(!
ªsu…
)

299 
	`dól_wôh_îr‹
(-3);

300 
	`˛o£
(
comm™d_sock
);

301  
FALSE
;

306 
Àn
 = 
	`•rötf
(
comm™d
, "USER %s\r", 
u£r_«me
);

307 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
, 
comm™d
, "331", 
ª∂y
, 
Àn
);

308 if(!
ªsu…
)

310  
FALSE
;

314 
Àn
 = 
	`•rötf
(
comm™d
, "PASS %s\r",
∑sswd
);

315 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
, 
comm™d
, "230", 
ª∂y
, 
Àn
);

316 if(!
ªsu…
)

318  
FALSE
;

322 
Àn
 = 
	`•rötf
(
comm™d
,"SYST\r",
NULL
);

323 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
, 
comm™d
, "215", 
ª∂y
, 
Àn
);

324 if(!
ªsu…
)

326  
FALSE
;

330 
Àn
 = 
	`•rötf
(
comm™d
,"PWD\r",
NULL
);

331 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
, 
comm™d
, "257", 
ª∂y
, 
Àn
);

332 if(!
ªsu…
)

334  
FALSE
;

336 
	`gë_w‹k_dúe˘‹y
(
ª∂y
);

338 
	`show_ãxt_√ws
("OK!!!!!!!!!!!");

341 
	`make_d©a_c⁄√˘i⁄
(
NULL
);

342  
TRUE
;

343 
	}
}

346 * 
	$make_d©a_c⁄√˘i⁄
(*
¨g
)

349 
	`show_ãxt_√ws
("Input into make_data_connection");

350 
ª∂y
[100];

351 
Àn
;

352 
göt
 
ªsu…
;

355 if(
d©a_c⁄√˘i⁄_mëhod
 == 1)

358 *
ù
 = "127.0.0.1";

359 
sockaddr_ö
 
p‹t_£rvî_sö
;

362 
ªsu…
 = 
	`p‹t_å™s„r_böd
(&
p‹t_£rvî_sö
,
ù
);

363 
ªsu…
)

366 
	`show_ãxt_√ws
("the ipÉrror!!!");

367 
	`˛o£
(
p‹t_li°í_sock
);

370 
	`show_ãxt_√ws
("port method bindÉrror");

371 
	`˛o£
(
p‹t_li°í_sock
);

374 
	`show_ãxt_√ws
("listenÉrror");

375 
	`˛o£
(
p‹t_li°í_sock
);

382 
sockÀn_t
 
s_Àn
 = (
p‹t_£rvî_sö
);

383 if(
	`gësock«me
(
p‹t_li°í_sock
,(
sockaddr
*)&
p‹t_£rvî_sö
,&
s_Àn
) != 0)

385 
	`show_ãxt_√ws
("Can't getÖort info");

387 
p‹t
 = 
	`¡ohs
(
p‹t_£rvî_sö
.
sö_p‹t
);

388 
f‹mî
[5];

389 
	`•rötf
(
f‹mî
,"%d",
p‹t
/256);

390 
œâî
[5];

391 
	`•rötf
(
œâî
,"%d",
p‹t
%256);

394 
Àn
 = 
	`•rötf
(
comm™d
,"PORT %s,%s,%s\r\n","127,0,0,1",
f‹mî
,
œâî
);

395 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
,
comm™d
,"200",
ª∂y
,
Àn
);

396 if(
ªsu…
 =
FALSE
)

402 
Àn
 = 
	`•rötf
(
comm™d
,"LIST\r\n",
NULL
);

403 
ªsu…
 = 
	`£nd_™d_ª•⁄£
(
comm™d_sock
,
comm™d
,"150",
ª∂y
,
Àn
);

404 if(
ªsu…
 =
FALSE
)

410 
sockaddr_ö
 
˛õ¡_sö
;

413 
˛õ¡_Àn
 = (
˛õ¡_sö
);

414 
d©a_sock
 = 
	`ac˚±
(
p‹t_li°í_sock
,(
sockaddr
*)&
˛õ¡_sö
,&
˛õ¡_Àn
);

415 if(
d©a_sock
 < 0)

417 if(
î∫o
 =
EINTR
)

421 
	`≥º‹
("acceptÉrror:\n");

422 
	`exô
(0);

427 
	`gë_ªmŸe_öfo
();

431 if(
d©a_c⁄√˘i⁄_mëhod
 == 2)

433 
	`show_ãxt_√ws
("passive method");

436 
	}
}

439 
	$gë_ªmŸe_öfo
()

441 if(
d©a_sock
 < 0)

446 
ªsu…
 = 
	`gë_ªmŸe_fûñi°
(
d©a_sock
);

447 
ªsu…
)

450 
	`show_ãxt_√ws
("Remote filelistÜink malloc Error!!!");

453 
	`show_ãxt_√ws
("Recv Error!!!(data connection)");

460 
	`£t_ªmŸe_fûñi°_åìvõw_modñ
();

461 
	`show_ãxt_√ws
("setÑeomte model success\n");

462 
	}
}

466 
gboﬁón
 
	$ª•⁄£_buâ⁄_ab‹t_down
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

468 
comm™d
[20];

469 
ª∂y
[100];

470 
gboﬁón
 
ªsu…
;

471 if(
d©a_sock
 != -1)

473 
Àn
 = 
	`•rötf
(
comm™d
,"ABOR\r",
NULL
);

474 
	`£nd_™d_ª•⁄£
(
comm™d_sock
,
comm™d
,"226",
ª∂y
,
Àn
);

475 if(!
ªsu…
)

477  
FALSE
;

480 
	`˛o£
(
d©a_sock
);

481 
d©a_sock
 = -1;

484 
	`show_ãxt_√ws
("Haven't make data connection ");

485  
TRUE
;

486 
	}
}

490 
	$ª•⁄£_ødio_buâ⁄
(
GtkWidgë
 * 
widgë
, 
gpoöãr
 
d©a
)

492 
d©a_c⁄√˘i⁄_mëhod
 = (
göt
)
d©a
;

493 
	}
}

497 
	$show_ãxt_√ws
(c⁄° *
msg
)

499 
GtkTextIãr
 
ôî
;

500 
GtkTextBuf„r
 *
buf
;

501 *
ídl
 = "\n";

502 
buf
 = 
	`gtk_ãxt_võw_gë_buf„r
((
GtkTextVõw
*)
ãxt_võw_öãºa˘
);

503 
	`gtk_ãxt_buf„r_gë_íd_ôî
(
buf
,&
ôî
);

504 
	`gtk_ãxt_buf„r_ö£π
(
buf
,&
ôî
,
msg
,-1);

505 
	`gtk_ãxt_buf„r_ö£π
(
buf
,&
ôî
,
ídl
,-1);

506 
	`gtk_ãxt_võw_£t_buf„r
((
GtkTextVõw
*)
ãxt_võw_öãºa˘
,
buf
);

507 
ãxt_m¨k_log
 = 
	`gtk_ãxt_buf„r_¸óã_m¨k
(
buf
,
NULL
,&
ôî
,1);

510 
	`gtk_ãxt_buf„r_move_m¨k
(
buf
,
ãxt_m¨k_log
,&
ôî
);

511 
	`gtk_ãxt_võw_s¸ﬁl_to_m¨k
(
	`GTK_TEXT_VIEW
(
ãxt_võw_öãºa˘
),
ãxt_m¨k_log
,0,1,1,1);

512 
	}
}

516 
gch¨
 *
	$_
(*
°rög
)

518  (
	`g_loˇÀ_to_utf8
(
°rög
,-1,
NULL
,NULL,NULL));

519 
	}
}

522 
GtkWidgë
 *
	$¸óã_wödow
()

526 if(
	`±hªad_muãx_öô
(&
gtk_muãx
,
NULL
) != 0)

528 
	`exô
(0);

532 
GtkWidgë
 *
maö_wödow
;

535 
GtkWidgë
 *
vbox_maö
;

538 
GtkWidgë
 *
hbox_míu
;

539 
GtkWidgë
 *
míu_b¨
;

540 
GtkWidgë
 *
míu_·p
;

541 
GtkWidgë
 *
ôem_FTP
;

542 
GtkWidgë
 *
ôem_Quô
;

544 
GtkWidgë
 *
míu_hñp
;

545 
GtkWidgë
 *
ôem_Hñp
;

546 
GtkWidgë
 *
ôem_About
;

551 
GtkWidgë
 *
hbox_logö
;

552 
GtkWidgë
 *
œbñ_IP
;

553 
GtkWidgë
 *
œbñ_PORT
;

554 
GtkWidgë
 *
œbñ_u£∫ame
;

555 
GtkWidgë
 *
œbñ_PASSWD
;

556 
GtkWidgë
 *
buâ⁄_logö
;

557 
GtkWidgë
 *
image_logö
;

558 
GtkWidgë
 *
buâ⁄_ab‹t
;

559 
GtkWidgë
 *
image_ab‹t
;

560 
GtkWidgë
 *
vbox_ødio_buâ⁄
;

561 
GtkWidgë
 *
ødio_buâ⁄_p‹t
;

562 
GtkWidgë
 *
ødio_buâ⁄_∑ssive
;

565 
GtkWidgë
 *
hbox_fûñi°
;

567 
GtkWidgë
 *
vbox_loˇŒi°
;

568 
GtkWidgë
 *
íåy_buf_cw
;

570 
GtkWidgë
 *
vbox_ªmŸñi°
;

571 
GtkWidgë
 *
íåy_ªmŸewd
;

575 
GtkWidgë
 *
hbox_scheduÀ
;

578 
GtkWidgë
 *
hbox_öãºa˘
;

579 
GtkWidgë
 *
sw_öãºa˘
;

583 
maö_wödow
 = 
	`gtk_wödow_√w
(
GTK_WINDOW_TOPLEVEL
);

584 
	`gtk_widgë_£t_usize
(
maö_wödow
,1200,600);

585 
	`gtk_wödow_£t_tôÀ
((
GtkWödow
*)
maö_wödow
,
	`_
("zhuhaichao-ftpclient"));

586 
	`gtk_wödow_£t_posôi⁄
((
GtkWödow
*)
maö_wödow
,
GTK_WIN_POS_CENTER
);

587 
	`gtk_wödow_£t_ªsizabÀ
((
GtkWödow
*)
maö_wödow
,
TRUE
);

588 
	`g_sig«l_c⁄√˘
(
maö_wödow
,"dñëe_evít",
	`G_CALLBACK
(
dñëe_evít_t›_wödow
),
NULL
);

589 
	`g_sig«l_c⁄√˘
(
maö_wödow
,"de°roy",
	`G_CALLBACK
(
de°roy
),
NULL
);

592 
vbox_maö
 = 
	`gtk_vbox_√w
(
FALSE
,0);

593 
	`gtk_widgë_show
(
vbox_maö
);

594 
	`gtk_c⁄èöî_add
((
GtkC⁄èöî
*)
maö_wödow
,
vbox_maö
);

599 
hbox_míu
 = 
	`gtk_hbox_√w
(
FALSE
,0);

600 
	`gtk_widgë_show
(
hbox_míu
);

601 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_maö
,
hbox_míu
,
FALSE
,FALSE,0);

603 
míu_b¨
 = 
	`gtk_míu_b¨_√w
();

604 
	`gtk_widgë_show
(
míu_b¨
);

605 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_míu
,
míu_b¨
,
TRUE
,TRUE,0);

607 
míu_·p
 = 
	`gtk_míu_√w
();

608 
	`gtk_widgë_show
(
míu_·p
);

610 
ôem_FTP
 = (
GtkWidgë
*)
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("FTP"));

611 
	`gtk_widgë_show
(
ôem_FTP
);

613 
ôem_Quô
 = (
GtkWidgë
*)
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("Quit"));

614 
	`gtk_widgë_show
(
ôem_Quô
);

616 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu_b¨
),
ôem_FTP
);

617 
	`gtk_míu_ôem_£t_submíu
(
	`GTK_MENU_ITEM
(
ôem_FTP
),
míu_·p
);

618 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu_·p
),
ôem_Quô
);

619 
	`g_sig«l_c⁄√˘
(
ôem_Quô
,"a˘iv©e",
	`G_CALLBACK
(
de°roy_widgë
),
maö_wödow
);

621 
míu_hñp
 = 
	`gtk_míu_√w
();

622 
	`gtk_widgë_show
(
míu_hñp
);

624 
ôem_Hñp
 = (
GtkWidgë
*)
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("Help"));

625 
	`gtk_widgë_show
(
ôem_Hñp
);

627 
ôem_About
 = (
GtkWidgë
*)
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("about"));

628 
	`gtk_widgë_show
(
ôem_About
);

630 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu_b¨
),
ôem_Hñp
);

631 
	`gtk_míu_ôem_£t_submíu
(
	`GTK_MENU_ITEM
(
ôem_Hñp
),
míu_hñp
);

632 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu_hñp
),
ôem_About
);

637 
GtkE¡ryBuf„r
 *
íåy_buf„r_ù
,*
íåy_buf„r_p‹t
,*
íåy_buf„r_u£∫ame
;

638 
gch¨
 
ù
[10] = "127.0.0.1";

639 
gch¨
 
p‹t
[5] = "21";

640 
gch¨
 
u£∫ame
[20]="anonymous";

641 
íåy_buf„r_ù
 = 
	`gtk_íåy_buf„r_√w
(
	`_
(
ù
),(ip));

642 
íåy_buf„r_p‹t
 = 
	`gtk_íåy_buf„r_√w
(
	`_
(
p‹t
),(port));

643 
íåy_buf„r_u£∫ame
 = 
	`gtk_íåy_buf„r_√w
(
	`_
(
u£∫ame
),(username));

645 
hbox_logö
 = 
	`gtk_hbox_√w
(
FALSE
,0);

646 
	`gtk_widgë_show
(
hbox_logö
);

647 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_maö
,
hbox_logö
,
FALSE
,FALSE,0);

649 
œbñ_IP
 = 
	`gtk_œbñ_√w
(
	`_
("IP:"));

650 
	`gtk_widgë_show
(
œbñ_IP
);

651 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
œbñ_IP
,
FALSE
,FALSE,0);

653 
íåy_IP
 = 
	`gtk_íåy_√w_wôh_buf„r
(
íåy_buf„r_ù
);

654 
	`gtk_widgë_show
(
íåy_IP
);

655 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
íåy_IP
,
TRUE
,TRUE,0);

657 
œbñ_PORT
 = 
	`gtk_œbñ_√w
(
	`_
(" PORT:"));

658 
	`gtk_widgë_show
(
œbñ_PORT
);

659 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
œbñ_PORT
,
FALSE
,FALSE,0);

661 
íåy_PORT
 = 
	`gtk_íåy_√w_wôh_buf„r
(
íåy_buf„r_p‹t
);

662 
	`gtk_widgë_show
(
íåy_PORT
);

663 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
íåy_PORT
,
TRUE
,TRUE,0);

666 
œbñ_u£∫ame
 = 
	`gtk_œbñ_√w
(
	`_
(" USER NAME:"));

667 
	`gtk_widgë_show
(
œbñ_u£∫ame
);

668 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
œbñ_u£∫ame
,
FALSE
,FALSE,0);

670 
íåy_u£∫ame
 = 
	`gtk_íåy_√w_wôh_buf„r
(
íåy_buf„r_u£∫ame
);

671 
	`gtk_widgë_show
(
íåy_u£∫ame
);

672 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
íåy_u£∫ame
,
TRUE
,TRUE,0);

674 
œbñ_PASSWD
 = 
	`gtk_œbñ_√w
(
	`_
(" PASSWD"));

675 
	`gtk_widgë_show
(
œbñ_PASSWD
);

676 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
œbñ_PASSWD
,
FALSE
,FALSE,0);

678 
íåy_PASSWD
 = 
	`gtk_íåy_√w
();

679 
	`gtk_widgë_show
(
íåy_PASSWD
);

680 
	`gtk_íåy_£t_visibûôy
((
GtkE¡ry
*)
íåy_PASSWD
,
FALSE
);

681 
	`gtk_íåy_£t_övisibÀ_ch¨
((
GtkE¡ry
*)
íåy_PASSWD
,'*');

682 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
íåy_PASSWD
,
TRUE
,TRUE,0);

684 
buâ⁄_logö
 = 
	`gtk_buâ⁄_√w
();

685 
	`gtk_widgë_show
(
buâ⁄_logö
);

686 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
buâ⁄_logö
,
FALSE
,FALSE,0);

687 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
buâ⁄_logö
),"˛icked",
	`G_CALLBACK
(
ª•⁄£_buâ⁄_logö_down
),
NULL
);

689 
image_logö
 = 
	`gtk_image_√w
();

690 
	`gtk_image_£t_‰om_°ock
(
	`GTK_IMAGE
(
image_logö
),
GTK_STOCK_OK
,
GTK_ICON_SIZE_DND
);

691 
	`gtk_widgë_show
(
image_logö
);

692 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄_logö
),
image_logö
);

695 
buâ⁄_ab‹t
 = 
	`gtk_buâ⁄_√w
();

696 
	`gtk_widgë_show
(
buâ⁄_ab‹t
);

697 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
buâ⁄_ab‹t
,
FALSE
,FALSE,0);

698 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
buâ⁄_ab‹t
),"˛icked",
	`G_CALLBACK
(
ª•⁄£_buâ⁄_ab‹t_down
),
NULL
);

700 
image_ab‹t
 = 
	`gtk_image_√w
();

701 
	`gtk_image_£t_‰om_°ock
(
	`GTK_IMAGE
(
image_ab‹t
),
GTK_STOCK_CANCEL
,
GTK_ICON_SIZE_DND
);

702 
	`gtk_widgë_show
(
image_ab‹t
);

703 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄_ab‹t
),
image_ab‹t
);

705 
vbox_ødio_buâ⁄
 = 
	`gtk_vbox_√w
(
FALSE
,0);

706 
	`gtk_widgë_show
(
vbox_ødio_buâ⁄
);

707 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_logö
,
vbox_ødio_buâ⁄
,
TRUE
,TRUE,0);

709 
ødio_buâ⁄_p‹t
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
(
NULL
,
	`_
("PORT"));

710 
	`gtk_widgë_show
(
ødio_buâ⁄_p‹t
);

711 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_ødio_buâ⁄
,
ødio_buâ⁄_p‹t
,
TRUE
,TRUE,0);

712 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ødio_buâ⁄_p‹t
),"toggÀd",
	`G_CALLBACK
(
ª•⁄£_ødio_buâ⁄
),(
gpoöãr
)1);

714 
ødio_buâ⁄_∑ssive
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
(
	`gtk_ødio_buâ⁄_gë_group
(
	`GTK_RADIO_BUTTON
(
ødio_buâ⁄_p‹t
)),

715 
	`_
("PASSIVE"));

716 
	`gtk_widgë_show
(
ødio_buâ⁄_∑ssive
);

717 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_ødio_buâ⁄
,
ødio_buâ⁄_∑ssive
,
TRUE
,TRUE,0);

718 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ødio_buâ⁄_p‹t
),"toggÀd",
	`G_CALLBACK
(
ª•⁄£_ødio_buâ⁄
),(
gpoöãr
)2);

722 
hbox_fûñi°
 = 
	`gtk_hbox_√w
(
FALSE
,0);

723 
	`gtk_widgë_show
(
hbox_fûñi°
);

724 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_maö
,
hbox_fûñi°
,
TRUE
,TRUE,0);

725 
	`gtk_widgë_£t_usize
(
hbox_fûñi°
,1200,250);

727 
vbox_loˇŒi°
 = 
	`gtk_vbox_√w
(
FALSE
,0);

728 
	`gtk_widgë_show
(
vbox_loˇŒi°
);

729 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_fûñi°
,
vbox_loˇŒi°
,
FALSE
,FALSE,0);

732 if(
	`gëcwd
(
cuºít_dú
,
MAXPATHLEN
Ë=
NULL
)

734 
	`exô
(0);

736 
Àn
 = 
	`°æí
(
cuºít_dú
);

737 
íåy_buf_cw
 = (
GtkWidgë
*)
	`gtk_íåy_buf„r_√w
(
cuºít_dú
,
Àn
);

739 
íåy_loˇlwd
 = 
	`gtk_íåy_√w_wôh_buf„r
((
GtkE¡ryBuf„r
*)
íåy_buf_cw
);

740 
	`gtk_widgë_show
(
íåy_loˇlwd
);

741 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_loˇŒi°
,
íåy_loˇlwd
,
FALSE
,FALSE,0);

743 
sw_loˇŒi°
 = 
	`gtk_s¸ﬁÀd_wödow_√w
(
NULL
,NULL);

744 
	`gtk_widgë_show
(
sw_loˇŒi°
);

745 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
(
	`GTK_SCROLLED_WINDOW
(
sw_loˇŒi°
),
GTK_SHADOW_ETCHED_IN
);

746 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
(
	`GTK_SCROLLED_WINDOW
(
sw_loˇŒi°
),
GTK_POLICY_NEVER
,
GTK_POLICY_AUTOMATIC
);

747 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_loˇŒi°
,
sw_loˇŒi°
,
TRUE
,TRUE,0);

750 if(
	`wrôe_loˇŒi°
(
cuºít_dú
,&
loˇl_fûe
Ë=
FALSE
)

752 
	`exô
(0);

754 
modñ
 = 
	`¸óã_li°_modñ
(
loˇl_fûe
,
sum_fûes
);

755 
åìvõw_loˇl
 = 
	`gtk_åì_võw_√w_wôh_modñ
(
modñ
);

756 
	`gtk_widgë_show
(
åìvõw_loˇl
);

757 
	`gtk_åì_võw_£t_ruÀs_höt
(
	`GTK_TREE_VIEW
(
åìvõw_loˇl
),
TRUE
);

758 
	`gtk_åì_võw_£t_£¨ch_cﬁumn
(
	`GTK_TREE_VIEW
(
åìvõw_loˇl
),
NUM_COLUMNS
);

759 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
sw_loˇŒi°
),
åìvõw_loˇl
);

760 
	`add_cﬁumns
(
	`GTK_TREE_VIEW
(
åìvõw_loˇl
));

761 
	`g_obje˘_uƒef
(
modñ
);

762 
	`g_sig«l_c⁄√˘
(
íåy_loˇlwd
,"a˘iv©e",
	`G_CALLBACK
(
ª•⁄£_íåy_íãr
),
NULL
);

765 
vbox_ªmŸñi°
 = 
	`gtk_vbox_√w
(
FALSE
,0);

766 
	`gtk_widgë_show
(
vbox_ªmŸñi°
);

767 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_fûñi°
,
vbox_ªmŸñi°
,
TRUE
,TRUE,0);

769 
íåy_buf„r_£rvîwd
 = 
	`gtk_íåy_buf„r_√w
(
NULL
,-1);

771 
íåy_ªmŸewd
 = 
	`gtk_íåy_√w_wôh_buf„r
(
íåy_buf„r_£rvîwd
);

772 
	`gtk_widgë_show
(
íåy_ªmŸewd
);

773 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_ªmŸñi°
,
íåy_ªmŸewd
,
FALSE
,FALSE,0);

775 
sw_ªmŸñi°
 = 
	`gtk_s¸ﬁÀd_wödow_√w
(
NULL
,NULL);

776 
	`gtk_widgë_show
(
sw_ªmŸñi°
);

777 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
(
	`GTK_SCROLLED_WINDOW
(
sw_ªmŸñi°
),
GTK_SHADOW_ETCHED_IN
);

778 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
(
	`GTK_SCROLLED_WINDOW
(
sw_ªmŸñi°
),
GTK_POLICY_NEVER
,
GTK_POLICY_AUTOMATIC
);

779 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_ªmŸñi°
,
sw_ªmŸñi°
,
TRUE
,TRUE,0);

781 
modñ
 = 
	`¸óã_li°_modñ
(
ªmŸe_fûe
,
ªmŸe_fûíum
);

782 
åìvõw_ªmŸe
 = 
	`gtk_åì_võw_√w
();

783 
	`gtk_widgë_show
(
åìvõw_ªmŸe
);

784 
	`gtk_åì_võw_£t_ruÀs_höt
(
	`GTK_TREE_VIEW
(
åìvõw_ªmŸe
),
TRUE
);

785 
	`gtk_åì_võw_£t_£¨ch_cﬁumn
(
	`GTK_TREE_VIEW
(
åìvõw_ªmŸe
),
NUM_COLUMNS
);

786 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
sw_ªmŸñi°
),
åìvõw_ªmŸe
);

787 
	`add_cﬁumns
(
	`GTK_TREE_VIEW
(
åìvõw_ªmŸe
));

788 
	`g_obje˘_uƒef
(
modñ
);

793 
hbox_scheduÀ
 = 
	`gtk_hbox_√w
(
FALSE
,0);

794 
	`gtk_widgë_show
(
hbox_scheduÀ
);

795 
	`gtk_widgë_£t_usize
(
hbox_scheduÀ
,1200,50);

796 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_maö
,
hbox_scheduÀ
,
TRUE
,TRUE,0);

799 
hbox_öãºa˘
 = 
	`gtk_hbox_√w
(
FALSE
,0);

800 
	`gtk_widgë_show
(
hbox_öãºa˘
);

801 
	`gtk_widgë_£t_usize
(
hbox_öãºa˘
,1200,300);

802 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
vbox_maö
,
hbox_öãºa˘
,
TRUE
,TRUE,0);

804 
sw_öãºa˘
 = 
	`gtk_s¸ﬁÀd_wödow_√w
(
NULL
,NULL);

805 
	`gtk_widgë_show
(
sw_öãºa˘
);

807 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
(
	`GTK_SCROLLED_WINDOW
(
sw_öãºa˘
),
GTK_SHADOW_ETCHED_IN
);

808 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
(
	`GTK_SCROLLED_WINDOW
(
sw_öãºa˘
),
GTK_POLICY_NEVER
,
GTK_POLICY_AUTOMATIC
);

809 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
sw_öãºa˘
),5);

810 
	`gtk_s¸ﬁÀd_wödow_£t_∂a˚mít
(
	`GTK_SCROLLED_WINDOW
(
sw_öãºa˘
),
GTK_CORNER_BOTTOM_LEFT
);

813 
	`gtk_box_∑ck_°¨t
((
GtkBox
*)
hbox_öãºa˘
,
sw_öãºa˘
,
TRUE
,TRUE,0);

815 
ãxt_võw_öãºa˘
 = 
	`gtk_ãxt_võw_√w
();

816 
	`gtk_widgë_show
(
ãxt_võw_öãºa˘
);

817 
	`gtk_ãxt_võw_£t_edôabÀ
((
GtkTextVõw
*)
ãxt_võw_öãºa˘
,
FALSE
);

818 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
sw_öãºa˘
),
ãxt_võw_öãºa˘
);

821  
maö_wödow
;

822 
	}
}

	@ftpclient_UI.h

9 
	~"deföes.h
"

10 
	~"fûeutûs.h
"

11 
	~"å™s„r.h
"

13 #i‚de‡
__FTPCLIENT_UI_H


14 
	#__FTPCLIENT_UI_H


	)

16 #ifde‡
__˝lu•lus


22 
Fûe
 *
loˇl_fûe
 = 
NULL
;

23 
Fûe
 *
ªmŸe_fûe
 = 
NULL
;

24 
GtkTªeModñ
 *
modñ
 = 
NULL
;

26 
GtkWidgë
 *
¸óã_wödow
();

29 
gboﬁón
 
ª•⁄£_íåy_íãr
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
);

31 
add_cﬁumns
(
GtkTªeVõw
 *
åìvõw
);

32 
show_ãxt_√ws
(c⁄° *
msg
);

33 
gboﬁón
 
ª•⁄£_buâ⁄_logö_down
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
);

34 
dól_wôh_îr‹
(
göt
 
Êag
);

35 
gboﬁón
 
£nd_™d_ª•⁄£
(
sock
,*
comm™d
, c⁄° *
ok_°r
, *
ª∂y
, 
Àn
);

36 
ª•⁄£_ødio_buâ⁄
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

37 * 
make_d©a_c⁄√˘i⁄
(*
¨g
);

38 
gboﬁón
 
ª•⁄£_buâ⁄_ab‹t_down
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

39 
gë_ªmŸe_öfo
();

41 #ifde‡
__˝lu•lus


	@main.c

10 
	~"·p˛õ¡_UI.h
"

13 
	$maö
(
¨gc
, *
¨gv
[])

15 #ifde‡
G_THREAD_ENABLE


16 if(!
	`g_thªad_suµ‹ãd
())

18 
	`g_thªad_öô
(
NULL
);

19 
	`gdk_thªads_öô
();

23 
	`gtk_öô
(&
¨gc
, &
¨gv
);

24 
GtkWidgë
 *
maö_wödow
 = 
	`¸óã_wödow
();

25 
	`gtk_widgë_show
(
maö_wödow
);

27 
	`gdk_thªads_íãr
();

28 
	`gtk_maö
();

29 
	`gdk_thªads_Àave
();

32 
	}
}

	@transfer.c

9 
	~"å™s„r.h
"

11 
fûe_buf
 *
	gfûebuf_hód
 = 
NULL
;

12 
fûe_buf
 *
	gfûebuf_èû
 = 
NULL
;

13 
göt
 
	gªmŸe_fûíum
 = 0;

18 
	$make_£rvî_c⁄√˘i⁄
(c⁄° 
gch¨
 *
ho°
, c⁄° gch¨ *
£rvi˚
,
n£c
)

20 
ho°ít
 *
phe
;

21 
£rvít
 *
p£
;

22 
sockaddr_ö
 
sö
;

23 
s
;

25 
	`mem£t
(&
sö
,0,(sin));

26 
sö
.
sö_Ámûy
 = 
PF_INET
;

28 if(
p£
 = 
	`gë£rvby«me
(
£rvi˚
,"tcp"))

30 
sö
.
sö_p‹t
 = 
p£
->
s_p‹t
;

32 if((
sö
.
sö_p‹t
 = 
	`ht⁄s
(()
	`©oi
(
£rvi˚
))) == 0)

37 if(
phe
 = 
	`gëho°by«me
(
ho°
))

39 
	`mem˝y
(&
sö
.
sö_addr
, 
phe
->
h_addr
,Öhe->
h_Àngth
);

41 if((
sö
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
ho°
)Ë=
INADDR_NONE
)

46 
s
 = 
	`sockë
(
PF_INET
,
SOCK_STREAM
,0);

47 if(
s
<0)

52 
timevÆ
 
tm
;

53 
fd_£t
 
£t
;

54 
ul
 = 1;

56 
	`io˘l
(
s
,
FIONBIO
,&
ul
);

58 
gboﬁón
 
ªt
 = 
FALSE
;

59 
îr‹
 = -1;

60 
Àn
 = ();

62 if(
	`c⁄√˘
(
s
,(
sockaddr
*)&
sö
,(sin)) == -1)

64 
tm
.
tv_£c
 = 
TIME_OUT_SEC
;

65 
tm
.
tv_u£c
 = 0;

66 
	`FD_ZERO
(&
£t
);

67 
	`FD_SET
(
s
,&
£t
);

68 
ªsu…
;

69 
ªsu…
 =
	`£À˘
(
s
+1,
NULL
,&
£t
,NULL,(
timevÆ
*)&
tm
);

70 if(
ªsu…
 > 0)

72 
	`gësock›t
(
s
,
SOL_SOCKET
,
SO_ERROR
,&
îr‹
,(
sockÀn_t
*)&
Àn
);

73 if(
îr‹
 == 0)

75 
	`¥ötf
("connect success\n");

76 
ªt
 = 
TRUE
;

78 
ªt
 = 
FALSE
;

80 
ªt
 = 
FALSE
;

82 
ªt
 = 
TRUE
;

84 
ul
 = 0;

85 
	`io˘l
(
s
,
FIONBIO
,&
ul
);

87 if(
ªt
 =
FALSE
)

89 
	`˛o£
(
s
);

92  
s
;

93 
	}
}

96 
gboﬁón
 
	$£nd_comm™d_to_£rvî
(
sock
, c⁄° *
comm™d
)

98 
Àn
;

99 if((
Àn
 = 
	`£nd
(
sock
,
comm™d
,
	`°æí
(command),0)) < 0)

101  
FALSE
;

103  
TRUE
;

104 
	}
}

107 
gboﬁón
 
	$gë_ª∂y_‰om_£rvî
(
sock
, *
ªsu…
)

109 
	`mem£t
(
ªsu…
,0,(result));

110 
buf
[
READBUFSIZE
];

111 if(
	`ªcv
(
sock
, 
buf
, (buf), 0)<0)

113  
FALSE
;

115 
	`£t_d©a
(
buf
,
ªsu…
);

116  
TRUE
;

117 
	}
}

120 
gboﬁón
 
	$comm™d_is_ok
(c⁄° * 
ok_°r
, c⁄° *
ªsu…
)

122 if(
	`°∫cmp
(
ok_°r
,
ªsu…
,(ok_str)-1) == 0)

124  
TRUE
;

126  
FALSE
;

127 
	}
}

131 
göt
 
	$c⁄åﬁ_c⁄√˘i⁄_›î©i⁄
(
sock
, *
comm™d
, *
ª∂y
, c⁄° *
ok_°r
)

133 
gboﬁón
 
Êag
;

134 
	`mem£t
(
ª∂y
,0,
	`°æí
(reply));

135 
Êag
 = 
	`£nd_comm™d_to_£rvî
(
sock
, 
comm™d
);

136 if(!
Êag
)

141 
Êag
 = 
	`gë_ª∂y_‰om_£rvî
(
sock
, 
ª∂y
);

142 if(!
Êag
)

147 
Êag
 = 
	`comm™d_is_ok
(
ok_°r
, 
ª∂y
);

148 if(!
Êag
)

152 
	`mem£t
(
comm™d
,0,(command));

154 
	}
}

157 
	$£t_d©a
(*
§c
, *
de°
)

159 
i
 =0;

160 
èg
 =0;

161 
gboﬁón
 
hasbegun
 = 
FALSE
;

162 ;;
i
++)

164 if(
hasbegun
 =
TRUE
)

166 
de°
[
èg
] = 
§c
[
i
];

167 if(
§c
[
i
] == '\0' ||src[i] == '\r' || src[i] == '\n')

171 
èg
++;

175 if(
§c
[
i
] == ' ' || src[i] ==' ')

179 
de°
[0] = 
§c
[
i
];

180 
hasbegun
 = 
TRUE
;

181 
èg
 = 1;

186 
de°
[
èg
] = '\0';

187 
	}
}

191 
göt
 
	$p‹t_å™s„r_böd
(
sockaddr_ö
 *
p‹t_£rvî_sö
,c⁄° *
ù
)

194 
˛õaddr_Àn
;

195 
£rvaddr_Àn
;

196 
ho°ít
 *
phe
;

197 
sockÀn_t
 
£rvî_Àn
;

198 
Àn
 = 0;

200 
p‹t_£rvî_sö
->
sö_Ámûy
 = 
PF_INET
;

206 if((
p‹t_£rvî_sö
->
sö_addr
.
s_addr
 = 
	`öë_addr
(
ù
)Ë=
INADDR_NONE
)

212 
p‹t_£rvî_sö
->
sö_p‹t
 = 
	`ht⁄s
(0);

213 
£rvaddr_Àn
 = (
p‹t_£rvî_sö
);

214 
p‹t_li°í_sock
 = 
	`sockë
(
PF_INET
,
SOCK_STREAM
,
IPPROTO_TCP
);

215 if(
p‹t_li°í_sock
 < 0)

220 
Êag
 = 1;

221 
	`£tsock›t
(
p‹t_li°í_sock
,
SOL_SOCKET
,
SO_REUSEADDR
,(*)&
Êag
,());

222 
	`£tsock›t
(
p‹t_li°í_sock
,
IPPROTO_TCP
,1,(*)&
Êag
,());

224 
£rvî_Àn
 = (*
p‹t_£rvî_sö
);

226 if(
	`böd
(
p‹t_li°í_sock
,(
sockaddr
*)
p‹t_£rvî_sö
,
£rvî_Àn
)<0)

228 
	`≥º‹
("bindÉrror:\n");

232 if(
	`li°í
(
p‹t_li°í_sock
,1)<0)

234 
	`¥ötf
("listenÉrror\n");

238 
	}
}

241 
göt
 
	$gë_ªmŸe_fûñi°
(
d©a_fd
)

243 
göt
 
Àn
;

244 
fûe_buf
 *
fûebuf_√w
;

245 
buf
[300];

247 if(
fûebuf_hód
 !
NULL
)

249 
	`‰ì_ªmŸe_fûñi°
(&
fûebuf_hód
);

252 
fûebuf_hód
 = 
	`mÆloc
((
fûe_buf
));

253 if(
fûebuf_hód
 =
NULL
)

257 
fûebuf_èû
 = 
fûebuf_hód
;

260 
Àn
 = 
	`ªcv
(
d©a_fd
,
buf
,
	`°æí
(buf),0);

261 if(
Àn
 < 0)

263 
	`≥º‹
("recv:");

268 if(
Àn
 == 0)

273 if(
Àn
 > 0)

275 
fûebuf_√w
 = 
	`mÆloc
((
fûe_buf
));

276 if(
fûebuf_√w
 =
NULL
)

280 
	`°rcmp
(
fûebuf_√w
->
fûe_d©a
,
buf
);

281 
fûebuf_√w
->
√xt
 = 
NULL
;

282 if(
fûebuf_hód
 =
fûebuf_èû
)

284 
fûebuf_èû
 = 
fûebuf_√w
;

285 
fûebuf_hód
->
√xt
 = 
fûebuf_√w
;

289 
fûebuf_èû
->
√xt
 = 
fûebuf_√w
;

290 
fûebuf_èû
 = 
fûebuf_√w
;

292 
ªmŸe_fûíum
++;

296 
	}
}

300 
	$‰ì_ªmŸe_fûñi°
(
fûe_buf
 **
hód
)

302 
fûe_buf
 *
ãmp
;

303 
ãmp
 = (*
hód
)->
√xt
;

304 
ãmp
 !
NULL
)

306 
	`‰ì
(*
hód
);

307 *
hód
 = 
ãmp
;

308 
ãmp
 =Åemp->
√xt
;

310 
	`‰ì
(*
hód
);

312 *
hód
 = 
NULL
;

313 
	}
}

	@transfer.h

9 
	~"deföes.h
"

10 #i‚de‡
__TRANSFER_H


11 
	#__TRANSFER_H


	)

13 #ifde‡
__˝lu•lus


18 
make_£rvî_c⁄√˘i⁄
(c⁄° 
gch¨
 *
ho°
, c⁄° gch¨ *
£rvi˚
,
n£c
);

19 
gboﬁón
 
£nd_comm™d_to_£rvî
(
sock
, c⁄° *
comm™d
);

20 
gboﬁón
 
gë_ª∂y_‰om_£rvî
(
sock
, *
ªsu…
);

21 
gboﬁón
 
comm™d_is_ok
(c⁄° * 
ok_°r
, c⁄° *
ªsu…
);

22 
göt
 
c⁄åﬁ_c⁄√˘i⁄_›î©i⁄
(
sock
, *
comm™d
, *
ª∂y
, c⁄° *
ok_°r
);

23 
£t_d©a
(*
§c
, *
de°
);

24 
göt
 
p‹t_å™s„r_böd
(
sockaddr_ö
 *
p‹t_£rvî_sö
,c⁄° *
ù
);

25 
göt
 
gë_ªmŸe_fûñi°
(
d©a_fd
);

26 
‰ì_ªmŸe_fûñi°
(
fûe_buf
 **
hód
);

29 #ifde‡
__˝lu•lus


	@
1
.
0
9
130
In file included from ftpclient_UI.h
defines.h
fileutils.c
fileutils.h
ftpclient_UI.c
ftpclient_UI.h
main.c
transfer.c
transfer.h
